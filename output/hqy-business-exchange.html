<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>灏仟亿业务汇率</title>
  <style>
    :root { --primary:#2563eb; --bg:#f8fafc; --card:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb; }
    body { margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,"Helvetica Neue",sans-serif; background:var(--bg); color:var(--text); }
    header { background: white; box-shadow: 0 2px 10px rgba(0,0,0,.1); position: sticky; top:0; z-index:1000; }
    .header-content { display:flex; justify-content:space-between; align-items:center; padding:15px 30px; }
    .logo { font-size:24px; font-weight:700; color:#2563eb; text-decoration:none; }
    .nav-menu { display:flex; list-style:none; gap:30px; }
    .nav-menu li { position:relative; }
    .nav-menu li a { text-decoration:none; color:#64748b; font-weight:500; padding:10px 15px; border-radius:8px; display:block; }
    .nav-menu li a:hover, .nav-menu li a.active { color:#2563eb; background:rgba(37,99,235,.1); }
    .dropdown { position:relative; }
    .dropdown-content { display:none; position:absolute; top:100%; left:0; background:white; min-width:200px; box-shadow:0 4px 12px rgba(0,0,0,.15); border-radius:8px; z-index:1000; padding:8px 0; border:1px solid #e2e8f0; }
    .dropdown:hover .dropdown-content { display:block; }
    .dropdown-content a { padding:12px 20px; display:block; border-radius:0; font-size:14px; }
    .dropdown-content a:hover { background:rgba(37,99,235,.1); color:#2563eb; }

    .container { max-width:1600px; margin:24px auto; padding:0 16px; }
    .btn { padding:12px 24px; border:none; border-radius:8px; font-weight:500; cursor:pointer; transition:all .3s ease; font-size:14px; text-decoration:none; display:inline-block; text-align:center; }
    .btn.primary { background:var(--primary); color:#fff; }
    .btn.secondary { background:#6b7280; color:#fff; }

    .search-section { background:#fff; padding:25px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.05); margin-bottom:25px; border:1px solid var(--border); }
    .search-row { display:flex; gap:20px; align-items:end; flex-wrap:wrap; }
    .search-group { flex:1; min-width:180px; }
    .search-group label { display:block; margin-bottom:8px; font-weight:500; color:#374151; }
    .search-input { width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:8px; font-size:14px; }

    .table-container { background:#fff; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.05); overflow:hidden; border:1px solid var(--border); }
    .table-header { display:flex; justify-content:space-between; align-items:center; padding:25px; border-bottom:1px solid var(--border); }
    .table-title { font-size:20px; font-weight:600; color:#1e293b; }
    .table-actions { display:flex; gap:10px; }
    .table-wrapper { overflow-x:auto; position:relative; }
    .transfer-table { width:100%; min-width:1000px; border-collapse:collapse; position:relative; }
    .transfer-table th, .transfer-table td { padding:12px 10px; text-align:left; border-bottom:1px solid var(--border); font-size:12px; white-space:nowrap; color:#374151; }
    .transfer-table th { background:#f8fafc; font-weight:600; color:#374151; position:sticky; top:0; z-index:2; }

    .page-header { background:#fff; padding:30px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.05); margin-bottom:30px; border-left:4px solid #2563eb; }
    .page-title { font-size:28px; font-weight:700; color:#1e293b; margin-bottom:10px; }
    .page-description { color:#64748b; font-size:16px; }

    /* 分页样式 */
    .pagination-controls { display:flex; align-items:center; gap:8px; }
    .page-size-select { padding:6px 12px; border:1px solid var(--border); border-radius:6px; font-size:14px; }
    .pagination-container { display:flex; justify-content:space-between; align-items:center; padding:20px 25px; border-top:1px solid var(--border); background:#f8fafc; }
    .pagination-left { display:flex; align-items:center; gap:20px; }
    .pagination-info { color:#64748b; font-size:14px; }
    .pagination { display:flex; align-items:center; gap:8px; }
    .pagination-btn { padding:8px 12px; border:1px solid var(--border); background:white; border-radius:6px; cursor:pointer; font-size:14px; transition:all 0.2s; }
    .pagination-btn:hover:not(:disabled) { background:#f1f5f9; border-color:#cbd5e1; }
    .pagination-btn:disabled { opacity:0.5; cursor:not-allowed; }
    .pagination-btn.active { background:var(--primary); color:white; border-color:var(--primary); }
    .page-numbers { display:flex; gap:4px; }
    .page-jump { display:flex; align-items:center; gap:8px; margin-left:20px; }
    .jump-input { width:60px; padding:6px 8px; border:1px solid var(--border); border-radius:4px; text-align:center; font-size:14px; }
    .jump-btn { padding:6px 12px; border:1px solid var(--primary); background:var(--primary); color:white; border-radius:4px; cursor:pointer; font-size:14px; }
    .jump-btn:hover { background:#1d4ed8; }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <a href="index.html" class="logo">资金中台</a>
      <nav>
        <ul class="nav-menu">
          <li><a href="index.html">首页</a></li>
          <li class="dropdown">
            <a href="customer-management.html">账户管理</a>
            <div class="dropdown-content">
              <a href="customer-management.html">账户管理</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="online-recharge.html">转账和收款</a>
            <div class="dropdown-content">
              <a href="online-recharge.html">在线充值</a>
              <a href="transfer-audit.html">转账审核</a>
              <a href="account-config.html">收款账户</a>
              <a href="receiving-ledger.html">收款明细</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="transaction-details.html">交易管理</a>
            <div class="dropdown-content">
              <a href="transaction-details.html">交易明细</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="credit-audit.html">额度管理</a>
            <div class="dropdown-content">
              <a href="credit-audit.html">信用额度</a>
              <a href="credit-bill.html">额度账单</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="../Public component/button.html" target="_blank">公共组件</a>
            <div class="dropdown-content">
              <a href="../Public component/button.html" target="_blank">充值转账组件</a>
              <a href="../Public component/payment.html" target="_blank">支付组件</a>
              <a href="../Public component/payment2.html" target="_blank">支付组件(三列)</a>
              <a href="../Public component/view.html" target="_blank">钱包余额组件</a>
            </div>
          </li>
          <li class="dropdown">
            <a href="exchange-rate-detail.html" class="active">汇率管理</a>
            <div class="dropdown-content">
              <a href="exchange-rate-detail.html">中国人民银行汇率</a>
              <a href="exchange-rate-config.html">汇率浮动配置</a>
              <a href="hqy-business-exchange.html">灏仟亿业务汇率</a>
            </div>
          </li>
        </ul>
      </nav>
    </div>
  </header>
  <div class="container">
    <div class="page-header">
      <h1 class="page-title">灏仟亿业务汇率</h1>
      <p class="page-description">以中国人民银行人民币中间价为桥梁，计算其他币种之间的业务汇率。每半个月更新一次，取前半个月均值，版本格式：yyyymmddyyyymmdd，生成时间通常为每月15日和最后一天。</p>
    </div>

    <div class="search-section">
      <div class="search-row">
        <div class="search-group">
          <label>基准币种</label>
          <select class="search-input" id="fFrom">
            <option value="">全部</option>
          </select>
        </div>
        <div class="search-group">
          <label>目标币种</label>
          <select class="search-input" id="fTo">
            <option value="">全部</option>
          </select>
        </div>
        <div class="search-group">
          <label>版本（起止）</label>
          <input type="text" class="search-input" id="fVersion" placeholder="例如：2025010120250115" />
        </div>
        <div class="search-group">
          <label>生成时间</label>
          <input type="date" class="search-input" id="fGeneratedAt" />
        </div>
        <div style="display:flex; gap:10px;">
          <button class="btn primary" id="btnSearch">搜索</button>
          <button class="btn secondary" id="btnReset">重置</button>
        </div>
      </div>
    </div>

    <div class="table-container">
      <div class="table-header">
        <h3 class="table-title">业务汇率列表</h3>
        <div class="table-actions">
          <button class="btn primary" id="btnExport">导出</button>
        </div>
      </div>
      <div class="table-wrapper">
        <table id="tblRates" class="transfer-table">
          <thead>
            <tr>
              <th>基准币种</th>
              <th>目标币种</th>
              <th>业务汇率</th>
              <th>版本</th>
              <th>生成时间</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="pagination-container">
        <div class="pagination-left">
          <div class="pagination-controls">
            <span>每页显示：</span>
            <select id="pageSize" class="page-size-select">
              <option value="10">10条</option>
              <option value="20">20条</option>
              <option value="50">50条</option>
              <option value="100">100条</option>
            </select>
          </div>
          <div class="pagination-info">
            <span id="paginationInfo">显示第 1-10 条，共 72 条记录</span>
          </div>
        </div>
        <div class="pagination">
          <button id="firstPage" class="pagination-btn">首页</button>
          <button id="prevPage" class="pagination-btn">上一页</button>
          <div id="pageNumbers" class="page-numbers"></div>
          <button id="nextPage" class="pagination-btn">下一页</button>
          <button id="lastPage" class="pagination-btn">末页</button>
          <div class="page-jump">
            <span>跳转到</span>
            <input type="number" id="jumpToPage" class="jump-input" min="1" placeholder="页码">
            <button id="jumpBtn" class="jump-btn">跳转</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 示例：取若干天的人行CNY中间价（1单位外币兑人民币）用于演示半月均值
    const supported = ["USD","EUR","JPY","GBP","HKD","AUD","NZD","SGD","CHF","CAD"];
    const dailyRates = [
      { date: "2025-01-01", CNY: 1, USD: 7.1000, EUR: 7.9500, JPY: 0.0483, GBP: 9.4800, HKD: 0.9100, AUD: 4.6500, NZD: 4.1000, SGD: 5.5200, CHF: 8.9100, CAD: 5.1000 },
      { date: "2025-01-05", CNY: 1, USD: 7.1100, EUR: 7.9800, JPY: 0.0482, GBP: 9.5000, HKD: 0.9110, AUD: 4.6700, NZD: 4.1200, SGD: 5.5300, CHF: 8.9300, CAD: 5.1200 },
      { date: "2025-01-10", CNY: 1, USD: 7.0950, EUR: 7.9650, JPY: 0.0484, GBP: 9.4700, HKD: 0.9090, AUD: 4.6400, NZD: 4.0900, SGD: 5.5100, CHF: 8.9000, CAD: 5.0900 },
      { date: "2025-01-12", CNY: 1, USD: 7.1077, EUR: 8.0000, JPY: 0.04815, GBP: 9.6106, HKD: 0.9143, AUD: 4.6894, NZD: 4.1630, SGD: 5.5387, CHF: 8.9791, CAD: 5.1363 },
      { date: "2025-01-15", CNY: 1, USD: 7.1200, EUR: 8.0200, JPY: 0.0481, GBP: 9.6300, HKD: 0.9150, AUD: 4.7000, NZD: 4.1700, SGD: 5.5450, CHF: 8.9900, CAD: 5.1400 }
    ];

    function getHalfMonthWindow(today = new Date()){
      const y = today.getFullYear();
      const m = String(today.getMonth()+1).padStart(2,'0');
      const d = today.getDate();
      const first = `${y}${m}01`;
      const fifteenth = `${y}${m}15`;
      const lastDay = new Date(y, today.getMonth()+1, 0).getDate();
      const sixteenth = `${y}${m}16`;
      const last = `${y}${m}${String(lastDay).padStart(2,'0')}`;
      if (d <= 15) {
        return { start:first, end:fifteenth, plannedGen:`${y}-${m}-15 10:00:00` };
      } else {
        return { start:sixteenth, end:last, plannedGen:`${y}-${m}-${String(lastDay).padStart(2,'0')} 10:00:00` };
      }
    }

    function averageRatesWithin(startStr, endStr){
      const start = new Date(`${startStr.slice(0,4)}-${startStr.slice(4,6)}-${startStr.slice(6,8)}`);
      const end = new Date(`${endStr.slice(0,4)}-${endStr.slice(4,6)}-${endStr.slice(6,8)}`);
      const span = dailyRates.filter(x=>{
        const d = new Date(x.date);
        return d >= start && d <= end;
      });
      const avg = {};
      supported.forEach(ccy=>{
        const arr = span.map(x=>x[ccy]).filter(v=>typeof v==='number');
        avg[ccy] = arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : undefined;
      });
      return avg; // 外币→CNY 平均中间价（1单位外币兑人民币）
    }

    function buildBusinessRates(){
      // 模拟灏仟亿业务汇率数据
      const mockData = [
        { from: 'USD', to: 'EUR', rate: 0.9234, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'USD', to: 'JPY', rate: 147.85, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'USD', to: 'GBP', rate: 0.7892, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'USD', to: 'HKD', rate: 7.8123, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'USD', to: 'AUD', rate: 1.5234, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'USD', to: 'NZD', rate: 1.6789, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'USD', to: 'SGD', rate: 1.3456, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'USD', to: 'CHF', rate: 0.8765, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'USD', to: 'CAD', rate: 1.3567, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'USD', rate: 1.0832, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'JPY', rate: 160.12, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'GBP', rate: 0.8547, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'HKD', rate: 8.4567, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'AUD', rate: 1.6498, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'NZD', rate: 1.8182, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'SGD', rate: 1.4567, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'CHF', rate: 0.9492, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'EUR', to: 'CAD', rate: 1.4689, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'USD', rate: 0.0068, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'EUR', rate: 0.0062, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'GBP', rate: 0.0053, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'HKD', rate: 0.0528, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'AUD', rate: 0.0103, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'NZD', rate: 0.0114, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'SGD', rate: 0.0091, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'CHF', rate: 0.0059, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'JPY', to: 'CAD', rate: 0.0092, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'USD', rate: 1.2671, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'EUR', rate: 1.1700, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'JPY', rate: 187.23, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'HKD', rate: 9.8967, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'AUD', rate: 1.9301, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'NZD', rate: 2.1278, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'SGD', rate: 1.7045, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'CHF', rate: 1.1105, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'GBP', to: 'CAD', rate: 1.7189, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'USD', rate: 0.1280, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'EUR', rate: 0.1182, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'JPY', rate: 18.92, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'GBP', rate: 0.1010, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'AUD', rate: 0.1950, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'NZD', rate: 0.2149, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'SGD', rate: 0.1723, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'CHF', rate: 0.1122, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'HKD', to: 'CAD', rate: 0.1736, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'USD', rate: 0.6565, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'EUR', rate: 0.6061, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'JPY', rate: 97.05, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'GBP', rate: 0.5181, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'HKD', rate: 5.1282, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'NZD', rate: 1.1023, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'SGD', rate: 0.8834, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'CHF', rate: 0.5754, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'AUD', to: 'CAD', rate: 0.8901, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'USD', rate: 0.5957, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'EUR', rate: 0.5500, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'JPY', rate: 88.05, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'GBP', rate: 0.4700, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'HKD', rate: 4.6535, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'AUD', rate: 0.9072, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'SGD', rate: 0.8018, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'CHF', rate: 0.5221, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'NZD', to: 'CAD', rate: 0.8078, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'USD', rate: 0.7431, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'EUR', rate: 0.6864, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'JPY', rate: 109.87, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'GBP', rate: 0.5867, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'HKD', rate: 5.8043, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'AUD', rate: 1.1320, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'NZD', rate: 1.2472, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'CHF', rate: 0.6514, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'SGD', to: 'CAD', rate: 1.0078, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'USD', rate: 1.1408, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'EUR', rate: 1.0535, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'JPY', rate: 168.65, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'GBP', rate: 0.9005, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'HKD', rate: 8.9102, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'AUD', rate: 1.7379, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'NZD', rate: 1.9153, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'SGD', rate: 1.5352, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CHF', to: 'CAD', rate: 1.5472, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'USD', rate: 0.7371, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'EUR', rate: 0.6807, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'JPY', rate: 108.98, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'GBP', rate: 0.5818, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'HKD', rate: 5.7601, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'AUD', rate: 1.1234, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'NZD', rate: 1.2380, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'SGD', rate: 0.9922, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' },
        { from: 'CAD', to: 'CHF', rate: 0.6463, version: '2025010120250115', generatedAt: '2025-01-15 10:00:00' }
      ];
      return mockData;
    }

    const tbody = document.querySelector('#tblRates tbody');
    let businessRates = [];
    let currentPage = 1;
    let pageSize = 10;
    let filteredData = [];

    function fillCurrencyOptions(){
      const fromSel = document.getElementById('fFrom');
      const toSel = document.getElementById('fTo');
      supported.forEach(c=>{
        const o1 = document.createElement('option'); o1.value=c; o1.textContent=c; fromSel.appendChild(o1);
        const o2 = document.createElement('option'); o2.value=c; o2.textContent=c; toSel.appendChild(o2);
      });
    }

    function filterData(){
      const fFrom = document.getElementById('fFrom').value;
      const fTo = document.getElementById('fTo').value;
      const fVersion = document.getElementById('fVersion').value.trim();
      const fGen = document.getElementById('fGeneratedAt').value;
      filteredData = businessRates.filter(r=>{
        if (fFrom && r.from!==fFrom) return false;
        if (fTo && r.to!==fTo) return false;
        if (fVersion && r.version!==fVersion) return false;
        if (fGen && !r.generatedAt.startsWith(fGen)) return false;
        return true;
      });
      currentPage = 1; // 重置到第一页
    }

    function render(){
      tbody.innerHTML='';
      const startIndex = (currentPage - 1) * pageSize;
      const endIndex = startIndex + pageSize;
      const pageData = filteredData.slice(startIndex, endIndex);
      
      pageData.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.from}</td>
          <td>${r.to}</td>
          <td>${r.rate.toFixed(6)}</td>
          <td>${r.version}</td>
          <td>${r.generatedAt}</td>
        `;
        tbody.appendChild(tr);
      });
      
      updatePagination();
    }

    function updatePagination(){
      const totalPages = Math.ceil(filteredData.length / pageSize);
      const startIndex = (currentPage - 1) * pageSize + 1;
      const endIndex = Math.min(currentPage * pageSize, filteredData.length);
      
      // 更新分页信息
      document.getElementById('paginationInfo').textContent = 
        `显示第 ${startIndex}-${endIndex} 条，共 ${filteredData.length} 条记录`;
      
      // 更新按钮状态
      document.getElementById('firstPage').disabled = currentPage === 1;
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage === totalPages;
      document.getElementById('lastPage').disabled = currentPage === totalPages;
      
      // 更新页码按钮
      const pageNumbers = document.getElementById('pageNumbers');
      pageNumbers.innerHTML = '';
      
      const maxVisiblePages = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
      if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
        const btn = document.createElement('button');
        btn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
        btn.textContent = i;
        btn.onclick = () => goToPage(i);
        pageNumbers.appendChild(btn);
      }
    }

    function goToPage(page){
      const totalPages = Math.ceil(filteredData.length / pageSize);
      if (page >= 1 && page <= totalPages) {
        currentPage = page;
        render();
      }
    }

    function changePageSize(newSize){
      pageSize = parseInt(newSize);
      currentPage = 1;
      render();
    }

    function exportToCSV(){
      const headers = ['基准币种', '目标币种', '业务汇率', '版本', '生成时间'];
      const csvContent = [
        headers.join(','),
        ...filteredData.map(r => [
          r.from,
          r.to,
          r.rate.toFixed(6),
          r.version,
          r.generatedAt
        ].join(','))
      ].join('\n');
      
      const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `灏仟亿业务汇率_${new Date().toISOString().slice(0,10)}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    document.getElementById('btnSearch').addEventListener('click', ()=>{
      filterData();
      render();
    });
    document.getElementById('btnReset').addEventListener('click', ()=>{
      document.getElementById('fFrom').value='';
      document.getElementById('fTo').value='';
      document.getElementById('fVersion').value='';
      document.getElementById('fGeneratedAt').value='';
      filterData();
      render();
    });
    document.getElementById('btnExport').addEventListener('click', ()=>{
      exportToCSV();
    });

    // 分页事件监听
    document.getElementById('pageSize').addEventListener('change', (e)=>{
      changePageSize(e.target.value);
    });
    document.getElementById('firstPage').addEventListener('click', ()=>goToPage(1));
    document.getElementById('prevPage').addEventListener('click', ()=>goToPage(currentPage - 1));
    document.getElementById('nextPage').addEventListener('click', ()=>goToPage(currentPage + 1));
    document.getElementById('lastPage').addEventListener('click', ()=>{
      const totalPages = Math.ceil(filteredData.length / pageSize);
      goToPage(totalPages);
    });
    document.getElementById('jumpBtn').addEventListener('click', ()=>{
      const page = parseInt(document.getElementById('jumpToPage').value);
      if (page) {
        goToPage(page);
        document.getElementById('jumpToPage').value = '';
      }
    });
    document.getElementById('jumpToPage').addEventListener('keypress', (e)=>{
      if (e.key === 'Enter') {
        const page = parseInt(e.target.value);
        if (page) {
          goToPage(page);
          e.target.value = '';
        }
      }
    });

    document.addEventListener('DOMContentLoaded', ()=>{
      fillCurrencyOptions();
      businessRates = buildBusinessRates();
      filterData();
      render();
    });
  </script>
</body>
</html>


